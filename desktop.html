<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=.25"></meta>
<script>
(function(a,b){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))){window.location=b;}})(navigator.userAgent||navigator.vendor||window.opera,'http://moygen.rf.gd/graph2/index.html');
</script>

<style>
.b{
font-size:18px;
font-family:monospace;
visibility:visible;
position:relative;
background-color:#ffffff;
padding:11px;
border:1px solid #000000;
margin-right:-4px;
margin-left:-4px;
display:inline-block;
}
.t{
width:30%;
border-bottom:1px solid #cdcdcd;
margin:0px;

}
.t2{
width:70%;
border-bottom:1px solid #cdcdcd;
margin:0px;
padding:4px;

}

.container::-webkit-scrollbar{display:none;}/* Safari and Chrome */
.container{-ms-overflow-style:none; /* Internet Explorer 10+ */
scrollbar-width: none;  /* Firefox */}
</style>
</head>
<body id="bodyer" style="font-family:monospace;overflow:hidden;margin:0px;padding:0px;">
<script>
var usePHP=false;
var serverAddress='http://0.0.0.0:45267/';
var EPSILON=1.0e-6;
var Vertex;
var Triangle;
var Edge;
var triangulate;
var edges;
var vertices;
var triangles;
var vertPairs;
var pairString='';
var fourColor=["red","gold","MediumSeaGreen","DeepSkyBlue","white"];
var fourColorShort=['R','Y','G','B','W'];
var savedData=[];
var triColors=[];
var dragging=false;
var altKey=false;
var inset=125;
var vertexToEdit=-1;
var backgroundColor='#f5f5f5';
var dataFileName="default.txt";
var numSavedGraphs=0;
var graphFileNames=[];
var dataSend='';
var dataReceive=null;
var getDataInterval=0;
var stringArr=[];
var pairArr=[];
var setRandomVerts=true;
var sortedVerts=[];
var counter=0;
var colorSavedGraph=false;
var xray=false;
var sameColorVerts=[];
var highlightSame=true;
var sortString='';
var searcher=[];
var lastSearcher=[];
var nonNeighbor=[];
var numSolves=0;
var solveCounter=0;
var chunkSolveString='';
var allSolvesString='';
var nIndexString='';
var loopingDetected=false;
var solveRemainingPass=0;
var loopCounter=0;
var tripleCheck=false;
var framesPerSecond=30;
var pauser=false;
var showSolving=false;
var stillSearching=false;
var animId=0;
var rColorGraphDone=false;
var animSV=0;
var stepping=false;
var solved=false;
var showNumNeigh=false;
var solving=false;
var timeToSolve=0;
var startTime=Date.now();
var endTime=Date.now();
var deltaTime=endTime-startTime;
var lastButton='buildRandomGraph';
var messageTimer=0;
var building=false;
var flexibles=[];
var showFlexibles=true;
var flexibleColor='#db37d9';
var numSolvesCounter=0;

var gettingLinkStart=false;
var addingVert=false;
var linkStart=-1;
var linkEnd=-1;
var startConnecting=false;
var endConnecting=false;
var delaunay=true;
var moveRaw=false;
var playOpening=false;
var buildTimer=0;clearTimeout(buildTimer);
var solveTimer=0;clearTimeout(solveTimer);
var numVertsTimer=0;clearTimeout(numVertsTimer);
var playOpeningTimer=0;clearTimeout(playOpeningTimer);
var animateTimer=0;clearTimeout(animateTimer);
var typing=false;

function getDeltaTime(){
deltaTime=endTime-startTime;
}//end getDeltaTime

function zoom(elm,scale,w,h){
elm.style.transform="scale("+scale+")";
elm.style.transformOrigin="top left";
elm.style.width=(w/scale)+"%";
elm.style.height=(h/scale)+"%";
}//end zoom



</script>

</div>

<div id="testerHolder" style="background-color:black;position:absolute;left:40px;top:40px;z-index:10000;border:6px solid white;display:none;height:70%;overflow:auto;">

<div id="tester" style="color:#00ff00;font-size:25px;word-wrap:break-word;padding:50px;padding-bottom:0px;padding-top:20px;overflow:auto;">
</div>
<div onmousedown="showHide('testerHolder');" style="text-align:center;color:#bbbbbb;bottom:0px;right:0px;font-size:20px;color:black;padding:10px;height:20px;width:20px;background-color:dddddd;border: 2px solid #bbbbbb;position:absolute;font-family:monospace;">x</div>
</div>

<div id="messageHolder" style="position:absolute;left:450px;top:500px;padding:60px;border:12px solid black;display:none;z-index:1000000;background-color:white;">

<div id="message" style="display:block;white-space:nowrap;font-family:monospace;font-weight:bold;color:black;font-size:40px;">
</div>
</div>


<iframe id="ifr" src="" style="display:none;z-index:1000;position:absolute;top:2000px;left:10px;height:1800px;width:1200px;border:1px solid black;">
</iframe>


<canvas id="canvas" width="440" height="550" style="position:absolute;left:0px;top:0px;z-index:100;"></canvas>


<div class="container" id="shortcutKeys" style="background-color:white;position:absolute;left:30px;top:30px;z-index:10000;border:2px solid black;display:none;height:70%;overflow:auto;padding:10px;margin:0px;">
<div id="shortcutKeysHeading" style="border:2px solid black;color:white;background-color:#000000;font-family:monospace;padding:10px;margin:0px;position:fixed;left:30px;top:30px;z-index:10001;">
<b>Shortcut Keys:</b>
</div>
<div style="background-color:#ffffff;font-family:monospace;padding:10px;">
<br><br>
<table>
<tr><td class="t">
    [P]: Show Solving </td><td class="t2">Renders each step of the 4-coloring algorithm as it solves the graph
<tr><td class="t">[S]: Solve </td><td class="t2">Renders result of solve and displays time in milliseconds
<tr><td class="t">[V]: Step </td><td class="t2">Advance one step of algorithm solving at a time 
<tr><td class="t">[B]: Build Random Graph </td><td class="t2">Build a random graph with delaunay triangulation
<tr><td class="t">[H]: Show/Hide Buttons </td><td class="t2">Show/Hide buttons for all functions
<tr><td class="t">[A]: Add Vertex </td><td class="t2">Click on graph to add a vertex with delaunay triangulation connecting it to surrounding Vertices
<tr><td class="t">[M]: Move Vertex </td><td class="t2">Click on a vertex and drag it to move it with delaunay triangulation adjusting connections 
<tr><td class="t">[D]: Delete Vertex </td><td class="t2">Click on a vertex to delete it with delaunay triangulation modifying surrounding connections
<tr><td class="t">[C] Color Vertex </td><td class="t2">Click on a vertex to change the color in cycles of red, yellow, green and blue
<tr><td class="t">[N] Number of Vertices</td><td class="t2">Set number of vertices
<tr><td class="t">[F] Frames Per Second</td><td class="t2">Set frames per second of animation when showing Solving
<tr><td class="t">[Y] Time to Solve</td><td class="t2">Display time to solve in milliseconds and number of steps
<tr><td class="t">[G] Number of Neighbors</td><td class="t2">Display numbers of neighbors on each vertex
<tr><td class="t">[X] Flexibles</td><td class="t2">Highlight the vertices which can be another color and list possible colors
<tr><td class="t">[O] Console</td><td class="t2">Enter a variable and hit enter to see the value of a global variable
<tr><td class="t">[1] Add Vertex<br>(no delaunay)</td><td class="t2">Click the graph to add a vertex without delaunay triangulation
<tr><td class="t">[2] Add a Linked Vertex<br>(no delaunay)</td><td class="t2">Click a starting vertex and then a free space to add a linked vertex without delaunay triangulation
<tr><td class="t">[3] Move a Vertex<br>(no delaunay)</td><td class="t2">Click a vertex and drag to move a vertex without delaunay triangulation
<tr><td class="t">[4] Delete a Vertex<br>(no delaunay)</td><td class="t2">Click a vertex to delete it without any delaunay triangulation
<tr><td class="t">[T] Tester Display</td><td class="t2">In the source javascript, use da('tester',variable); to overwrite tester; use daa... to append writes
<tr><td class="t">[K] Shortcut Keys</td><td class="t2">Toggle shortcut key list with descriptions
</td></tr></table>
</div>

</div>



<select id="selectGraph" onchange="setRandomVerts=false;dataFileName=graphFileNames[parseInt(this.options[this.selectedIndex].value)];buildAndRender();" style="z-index:10000000;font-size:40px;font-family:monospace;background-color:#ffffff;border:1px solid #000000;visibility:hidden;position:absolute;top:100px;left:250px;padding:30px;">
<option disabled selected id="label">Load Graph</option>
</select>



<div id="filenameInputDiv" style="z-index:10000000;position:fixed;left:50px;bottom:1000px;font-size:30px;font-family:monospace;background-color:#ffffff;padding:40px;border:1px solid black;visibility:hidden;height:40px">


Filename:
<input id="enterGraphName" type="text"  value="" style="display:inline-block;font-family:monospace;color:black;font-size:30px;border:1px solid black;" size="30">

<br>

<input value="save" type="button" onmousedown="dataFileName=el('enterGraphName').value+'.txt';el('filenameInputDiv').style.visibility='hidden';saveGraphData();"  style="display:inline-block;font-size:30px;margin-top:12px;">

<input value="cancel" type="button" onmousedown="el('filenameInputDiv').style.visibility='hidden';" style="display:inline-block;font-size:30px;margin-top:12px;">

</div>







<div id="buttonHolder" style="text-align:left;white-space:wrap;z-index:1000;position:fixed;background-color:#ffffff;padding:6px;bottom:10px;overflow:hidden;display:block;"><div id="buttonHolderInner" style="width:100%;">

<input id="buildRandomGraph" type="button" value="Build Graph" onmousedown="event.preventDefault();activeButton(this.id);building=true;buildRandomGraphButton();setRandomVerts=true;clearTimeout(buildTimer);buildTimer=setTimeout('buildAndRender();',50);canv.onmousedown=function(e){setRandomVerts=true;buildAndRender();};" class="b">

<input id="showSolving" type="button" value="Show Solving" 
onmousedown="event.preventDefault();activeButton(this.id);playOpening=false;showSolvingButton();" class="b">

<input id="solve" type="button" value="Solve" 
onmousedown="event.preventDefault();activeButton(this.id);stepping=false;pauser=false;showSolving=false;solving=true;solveButton();clearTimeout(solveTimer);solveTimer=setTimeout('for(let v=0;v<vertices.length;v++){vertices[v].c=4;}sortByNeighborCount();colorGraph();recursiveNeighborSolver();',10);" class="b">

<input id="step" type="button" value="Step" onmousedown="event.preventDefault();activeButton(this.id);solved=false;stepping=true;stepper();showSolving=false;showSolvingStatus();" class="b">



<!--<br>-->

<input id="addVertex" type="button" value="Add Vertex" 
onmousedown="event.preventDefault();activeButton(this.id);canv.onmousedown=function(e){delaunay=true;mouseAdd_Vertex(e);solved=false;}"    
class="b">



<input id="moveVertex" type="button" value="Move Vertex" 
onmousedown="event.preventDefault();activeButton(this.id);canv.onmousedown=function(e){el('expander').style.visibility='hidden';dragging=true;moveRaw=false;getVertexToEdit(e);solved=false;}" class="b">

<input id="deleteVertex" type="button" value="Delete Vertex" 
onmousedown="event.preventDefault();activeButton(this.id);canv.onmousedown=function(e){getVertexToEdit(e);deleteVertex(e,true);solved=false;}"    
class="b">


<input id="colorVerts" type="button" value="ColorVerts" onmousedown="event.preventDefault();activeButton(this.id);canv.onmousedown=function(e){getVertexToEdit(e);changeVertexColor(e);solved=false;}" class="b">

<!--<br>-->

<input id="numberOfVerts" type="button" value="Number of Verts" onmousedown="event.preventDefault();activeButton(this.id);el('enterNumVerts').value=numPoints;showHideV('numVertsInputDiv');" class="b">

<input id="fpsId" type="button" value="FPS" onmousedown=" activeButton(this.id);el('enterFPS').value=parseInt(framesPerSecond);showHideV('fpsInputDiv');" class="b">

<input id="timeToSolveId" type="button" value="TimeToSolve" onmousedown="event.preventDefault();activeButton(this.id);showMessage('Solved in: '+deltaTime+' ms<br> after '+ numSolvesCounter+' steps',2000);" class="b">

<input id="neighs" type="button" value="Neighs" 
onmousedown="event.preventDefault();activeButton(this.id);if(showNumNeigh){showNumNeigh=false;}else{showNumNeigh=true;}render();" class="b">

<!--<br>-->

<input type="button" value="Tester" id="testerButton"
onmousedown="event.preventDefault();activeButton(this.id);showHide('testerHolder');el('tester').scrollTop=el('tester').scrollHeight;" class="b">

<input type="button" value="loadGraph" id="loadGraphButton"
onmousedown="event.preventDefault();activeButton(this.id);showHideV('selectGraph');" class="b">


<input type="button" value="saveGraph" id="saveGraphButton"
onmousedown="event.preventDefault();activeButton(this.id);showHideV('filenameInputDiv');" class="b">


<input type="button" value="Flexibles" id="flexiblesButton"
onmousedown="event.preventDefault();activeButton(this.id);showFlexibles=!showFlexibles;render();" class="b">

<input type="button" value="Console" id="consoleButton"
onmousedown="event.preventDefault();activeButton(this.id);showHideV('consoleInputDiv');render();" class="b">

<div id="consoleInputDiv" style="z-index:10000000;position:fixed;left:50px;top:20px;width:90%;font-size:40px;font-family:monospace;background-color:#ffffff;padding:15px;border:1px solid black;visibility:hidden;height:450px;overflow:auto;">

<input id="consoleInput" type="text"  value="pairArr" style="font-family:monospace;color:black;font-size:40px;border:1px solid black;display:inline-block;padding:15px;" size="35" onmousedown="typing=true;">

<input value="Enter" type="button" onmousedown="typing=false;da('tester','<br>'+eval(el('consoleInput').value));da('consoler','<br>'+eval(el('consoleInput').value));" style="display:inline-block;font-size:45px;padding:15px;">

<div id="consoler"  style="width:100%;height:200px;display:block;font-size:30px;margin-top:12px;background-color:white;word-wrap:break-word;">Enter a Variable</div>

<div onmousedown="typing=false;showHideV('consoleInputDiv');" style="text-align:center;color:#bbbbbb;bottom:0px;right:0px;font-size:20px;color:black;padding:10px;height:20px;width:20px;background-color:dddddd;border: 2px solid #bbbbbb;position:absolute;font-family:monospace;">x</div>
</div>


<!--daa('tester','numPoints:'+numPoints+' --- diam:'+diam+' --- vertSize:'+vertSize+'<br><br>');-->

<!--<br>-->

<input type="button" value="add" id="addButton"
onmousedown="event.preventDefault();activeButton(this.id);gettingLinkStart=false;delaunay=false;canv.onmousedown=function(e){el('expander').style.visibility='hidden';mouseAdd_Vertex(e);solved=false;}" class="b">

<input type="button" value="addLinked" id="addLinkedButton"
onmousedown="event.preventDefault();activeButton(this.id);delaunay=false;gettingLinkStart=true;canv.onmousedown=function(e){el('expander').style.visibility='hidden';getVertexToEdit(e);solved=false;}" class="b">

<input type="button" value="Link" id="linkVertsButton"
onmousedown="event.preventDefault();activeButton(this.id);gettingLinkStart=false;startConnecting=true;delaunay=false;canv.onmousedown=function(e){el('expander').style.visibility='hidden';getVertexToEdit(e);solved=false;}" class="b">



<input id="moveVertButton" type="button" value="Move" 
onmousedown="event.preventDefault();activeButton(this.id);canv.onmousedown=function(e){el('expander').style.visibility='hidden';dragging=true;moveRaw=true;getVertexToEdit(e);solved=false;}" class="b">

<input id="deleteVertButton" type="button" value="Delete" 
onmousedown="event.preventDefault();activeButton(this.id);canv.onmousedown=function(e){delaunay=false;getVertexToEdit(e);deleteVertex(e,false);solved=false;}"    
class="b">

</div>
<div style="width:44px;">



</div>
</div><!--end buttonHolder-->

<input type="button" value="K" id="shortcuts" onmousedown="showHide('shortcutKeys');" style="color:#000000;text-align:center;right:0px;position:fixed;font-weight:bold;font-size:20px;font-family:monospace;white-space:nowrap;background-color:#ffffff;padding:6px;border:1px solid #000000;bottom:72px;z-index:1000000000;visibility:visible;width:40px;height:34px;margin:0px;">

<input type="button" value="[]" id="fullscreen" onmousedown="toggleFullScreen();" style="color:#000000;text-align:center;right:0px;position:fixed;font-weight:bold;font-size:16px;font-family:monospace;white-space:nowrap;background-color:#ffffff;padding:8px;border:1px solid #000000;right:0px;bottom:34px;z-index:1000000000;visibility:visible;width:40px;height:36px;margin:0px;vertical-align:top;" >

<input type="button" value="-" id="expander" onmousedown="controlPanelOpenClose();" style="color:#000000;text-align:center;right:0px;position:fixed;font-weight:bold;font-size:20px;font-family:monospace;white-space:nowrap;background-color:#ffffff;padding:6px;border:1px solid #000000;bottom:0px;z-index:100000000000;visibility:visible;width:40px;height:32px;margin:0px;">


<div id="numVertsInputDiv" style="font-size:50px;font-family:monospace;visibility:hidden;z-index:1000000;position:fixed;left:100px;bottom:0px;background-color:#ffffff;padding:30px;border:6px solid #000000;">

Number of Vertices:
<input id="enterNumVerts" type="text"  size="3" value="60" style="background-color:black;color:caret-color:white;font-family:monospace;color:white;font-size:70px;padding:10px"
onmousedown="typing=true;">

<input id="numVertsApply" value="Apply" type="button" onmousedown="typing=false;activeButton(this.id);flexibles=[];numPoints=parseInt(el('enterNumVerts').value);graphRenderScaleFactors();el('numVertsInputDiv').style.visibility='hidden';building=true;buildRandomGraphButton();setRandomVerts=true;clearTimeout(numVertsTimer);numVertsTimer=setTimeout('buildAndRender();',100);"  style="display:inline-block;font-size:50px;padding:10px;">

<input value="cancel" type="button" onmousedown="typing=false;el('numVertsInputDiv').style.visibility='hidden';" style="display:inline-block;font-size:50px;padding:10px;">

</div>


<div id="fpsInputDiv" style="font-size:50px;font-family:monospace;visibility:hidden;z-index:1000000;position:fixed;left:100px;bottom:0px;background-color:#ffffff;padding:30px;border:6px solid #000000;">


FPS (1-60):
<input id="enterFPS" type="text"  size="3" value="" style="font-family:monospace;color:black;font-size:50px;padding:10px" onmousedown="typing=true;">

<input value="Apply" type="button" onmousedown="typing=false;framesPerSecond=parseInt(el('enterFPS').value);if(framesPerSecond<1){framesPerSecond=1;}else if(framesPerSecond>120){framesPerSecond=120;}el('fpsInputDiv').style.visibility='hidden';"  style="display:inline-block;font-size:50px;padding:10px;">

<input value="cancel" type="button" onmousedown="typing=false;el('fpsInputDiv').style.visibility='hidden';" style="display:inline-block;font-size:50px;padding:10px;">

</div>
<script>


function el(a){return document.getElementById(a);}
function da(a,b){if(el(a)){el(a).innerHTML=b;
//el(a).style.display='block';
}}
function daa(a,b){if(el(a)){el(a).innerHTML+=b;
//el(a).style.display='block';
}}
function randRange(min, max){return Math.floor(Math.random() * (max - min + 1)) + min;}
function degToRad(a){return a*Math.PI/180;}
function isThere(a){return(typeof a!=="undefined"&&typeof a!==null&&(a||a==0));}
function els(a){return document.getElementById(a).style;}
function showHide(a){if(els(a).display=='block'){els(a).display='none'}else{els(a).display='block'}}

function showHideV(a){if(els(a).visibility=='visible'){els(a).visibility='hidden'}else{els(a).visibility='visible'}}

function activeButton(buttonId){
el(lastButton).style.backgroundColor='white';
el(buttonId).style.backgroundColor='#dbedff';
lastButton=buttonId;
}//activeButton

window.onresize=function(){init();};

var canv=document.getElementById("canvas");
var ctx=canv.getContext('2d');
var cW,cH,ww,hh;

function init(){
ww=window.innerWidth;
hh=window.innerHeight;
canv.width=window.innerWidth;
canv.height=window.innerHeight;
cW=canv.width;
cH=canv.height;
canv.style.width=cW+"px";
canv.style.height=cH+"px";
canv.style.left=(ww/2-cW/2)+'px';

el('shortcutKeys').style.width=ww*.93+'px';
el('shortcutKeysHeading').style.width=ww*.93+'px';

el('messageHolder').style.left=ww*.5-200+'px';
el('messageHolder').style.top=hh*.23+'px';

let bhStyle=getComputedStyle(el('buttonHolder'));
let bhHeight=bhStyle.height;
el('buttonHolder').style.width=ww+'px';
el('buttonHolderInner').style.width=ww-48+'px';
//el('expander').style.bottom=parseInt(bhHeight)+20+'px';

el('fpsInputDiv').style.bottom=parseInt(bhHeight)+100+'px';
el('numVertsInputDiv').style.bottom=parseInt(bhHeight)+100+'px';

el('testerHolder').style.width=ww*.5+'px';
el('consoleInputDiv').style.width=ww*.9+'px';

cancelAnimationFrame(animId);
buildAndRender();
animInit();
getGraphFilenames();
//controlPanelOpenClose();
}//end init

init();

function controlPanelOpenClose(){
if(el('buttonHolder').style.display=='none'){
el('buttonHolder').style.display='block';
da('expander','-');
}else{
el('buttonHolder').style.display='none';
da('expander','+');
}
}//end controlPanelOpenClose


function showBools(buttonValue){
da('tester',buttonValue+'<br>numSolves:'+numSolves+'<br>foundUnsolved:'+foundUnsolved+'<br>animSV:'+animSV+'<br>playOpening:'+playOpening+'<br>pauser:'+pauser+'<br>tripleCheck:'+tripleCheck+'<br>checkCounter:'+checkCounter+'<br>stillSearching:'+stillSearching+'<br> solved:'+solved+' <br>  rColorGraphDone:'+rColorGraphDone+' <br>showSolving: '+showSolving+'<br>-----------------<br>');
el('tester').scrollTop=el('tester').scrollHeight;
}//end showBools


function getGraphFilenames(){
if(usePHP){
el('ifr').src=serverAddress+'filenameReader.php';
setTimeout(function(){
graphFileNames=JSON.parse(el('ifr').contentWindow.filenames);

numSavedGraphs=graphFileNames.length;
initSelectGraph();
},500);
}//if usePHP
}//end get graph filenames

function initSelectGraph(){
for(let i=0;i<numSavedGraphs;i++){
let op=document.createElement("option");
op.id='op'+i;
op.value=i;
op.text=graphFileNames[i];
el('selectGraph').appendChild(op);
}//end i loop
//el('op0').selected="selected";
}//end init select graph

function getGraphData(){
if(usePHP){
el('ifr').src=serverAddress+"saver.php?loading=1&dataFileName="+dataFileName;
setTimeout("loadGraphData();",500);
}//usePHP
}//end getGraphData

function loadGraphData(){
dataReceive=el('ifr').contentWindow.dataSend;
if(!isThere(dataReceive)){
getGraphData();
}else{

if(dataReceive.indexOf('[')>=0){
delaunay=false;
}

if(!delaunay){
let pairArrString=
dataReceive.substring(0,dataReceive.lastIndexOf(']')+1.);

pairArr=JSON.parse(pairArrString);
dataReceive=
dataReceive.replace(pairArrString+' ','');
}//end if !delaunay

stringArr=dataReceive.split(" ");

for(let i=0;i<stringArr.length;i+=4){
vertices.push(new Vertex(parseInt(stringArr[i]),parseInt(stringArr[i+1]),parseInt(stringArr[i+2]),parseInt(stringArr[i+3])));
if(delaunay){
triangles=triangulate(vertices);
}
}//end i loop

if(delaunay){
sortByNeighborCount();
}
//if(colorSavedGraph){colorGraph();}
render();
dataReceive='';
}//end isThere
}//end loadGraphData


function saveGraphData(){
if(usePHP){
let graphData='';
for(let i=0;i<vertices.length;i++){
graphData+=parseInt(vertices[i].x)+' '+parseInt(vertices[i].y)+' '+vertices[i].c+' '+vertices[i].i+' ';
}//end i loop

if(!delaunay){
graphData=
JSON.stringify(pairArr)+' '+graphData;
}

/*
let pairArr=[[675,89],[98,2],[8,7]];
let dataSaved=JSON.stringify(pairArr);
pairArr=JSON.parse(dataSaved);
*/


if(!el('op'+numSavedGraphs)){
graphFileNames.push(dataFileName);
el('ifr').src=serverAddress+"saver.php?graphData="+graphData+"&saving=1&dataFileName="+dataFileName;
let op=document.createElement("option");
op.id='op'+numSavedGraphs;
op.value=numSavedGraphs;
op.text=dataFileName;
el('selectGraph').appendChild(op);
numSavedGraphs++;
}//end if(!el
}//usePHP
}//end saveGraphData


function changeVertexColor(e){
if(isThere(vertices[vertexToEdit])){
vertices[vertexToEdit].c++;
if(vertices[vertexToEdit].c>3){
vertices[vertexToEdit].c=0;
}
render();
}//is There
}// end changeVertexColor


canv.onmouseup=function(e){
dragging=false;
el('expander').style.visibility='visible';
render();
vertexToEdit=-1;
}//end onmouseup



canv.onmousemove=function(e){
if(dragging){
el('expander').style.visibility='hidden';
if(moveRaw){
moveVertex(e,delaunay=false);
}else{
moveVertex(e,delaunay=true);
}
sortByNeighborCount();
render();
}
}//end onmousemove


canv.onmousedown=function(e){
setRandomVerts=true;buildAndRender();
}



function moveVertex(e,delaunay){
if(vertexToEdit>=0){
vertices[vertexToEdit].x=e.pageX;
vertices[vertexToEdit].y=e.pageY;
ctx.clearRect(0,0,cW,cH);
if(delaunay){
triangles=triangulate(vertices);
}
render();
}
}//end moveVertex


function mouseAdd_Vertex(e){
ctx.clearRect(0,0,cW,cH);
vertices.push(new Vertex(e.pageX,e.pageY,4,vertices.length+1));
if(delaunay){
triangles=triangulate(vertices);
}
sortByNeighborCount();
render();
}//end mouseAdd_Vertex



function getVertexToEdit(e){
vertexToEdit=-1;
for(let i=0;i<vertices.length;i++){
ctx.beginPath();
ctx.arc(vertices[i].x, vertices[i].y, vertSize*2, 0, Math.PI * 2, true);
if(ctx.isPointInPath(e.pageX, e.pageY)){
vertexToEdit=i;

if(!delaunay){
if(gettingLinkStart){
linkStart=vertexToEdit;
addingVert=true;
//gettingLinkStart=false;
canv.onmousedown=function(e){
el('expander').style.visibility='hidden';
if(addingVert){
ctx.clearRect(0,0,cW,cH);
vertices.push(new Vertex(e.pageX,e.pageY,4,vertices.length));
linkEnd=vertices.length-1;
if(linkStart>=0&&linkEnd>=0){
pairArr.push([linkStart,linkEnd]);
linkStart=linkEnd;
}
sortByNeighborCount();
render();
//addingVert=false;
}
}//end function(e)

}else if(startConnecting){
addingVert=false;
linkStart=vertexToEdit;
startConnecting=false;
endConnecting=true;

}else if(endConnecting){
addingVert=false;
delaunay=false;
linkEnd=vertexToEdit;
if(linkStart>=0&&linkEnd>=0){
pairArr.push([linkStart,linkEnd]);
removeDuplicatePairs();
linkStart=linkEnd;
}
sortByNeighborCount();
render();
//endConnecting=false;
}
}//if(!delaunay

ctx.lineWidth='20';
ctx.strokeStyle=fourColor[vertices[vertexToEdit].c];
if(!endConnecting){
ctx.stroke();
}
}//ctx.isPointInPath
}//i loop
ctx.closePath();
}//end getVertexToEdit



function deleteVertex(e,delaunay){
if(vertexToEdit>=0){
vertices.splice(vertexToEdit,1);
for(let v=0;v<vertices.length;v++){
vertices[v].i=v;}

if(!delaunay){
for(let i=pairArr.length-1;i>=0;i--){
if(vertexToEdit==pairArr[i][0]||vertexToEdit==pairArr[i][1]){
pairArr.splice(i,1);
}
}//i loop
delaunay=false;
}//!delaunay

//ctx.clearRect(0,0,cW,cH);
if(delaunay){
triangles=triangulate(vertices);
}


for(let j=0;j<pairArr.length;j++){
if(pairArr[j][0]>vertexToEdit){
pairArr[j][0]--;}
if(pairArr[j][1]>vertexToEdit){
pairArr[j][1]--;}
}//j loop


sortByNeighborCount();
render();
}//>=0
}//end deleteVertex




function getVertexPairs(){
if(delaunay){
pairArr=[];
for(let i=0;i<triangles.length;i++){
pairArr.push([triangles[i].v0.i, triangles[i].v1.i]);
pairArr.push([triangles[i].v0.i, triangles[i].v2.i]);
pairArr.push([triangles[i].v1.i, triangles[i].v2.i]);
}//i loop

}
/*
else if(!delaunay){
if(linkStart>=0&&linkEnd>=0){
pairArr.push([linkStart,linkEnd]);
}//if(linkStart
}//end if !delaunay

*/

removeDuplicatePairs();

}//end getVertexPairs


//remove duplicate pairs
function removeDuplicatePairs(){
for(let i=pairArr.length-1;i>=1;i--){
for(let j=i-1;j>=0;j--){
if(isThere(pairArr[i])
&&
isThere(pairArr[j])){
if(
(pairArr[i][0]==pairArr[j][0]
&&
pairArr[i][1]==pairArr[j][1])
||
(pairArr[i][0]==pairArr[j][1]
&&
pairArr[i][1]==pairArr[j][0])
){
pairArr.splice(i,1);
}
}//end isThere
}//end j loop
}//end i loop
}//removeDuplicatePairs



function getNeighbors(){
getVertexPairs();
for(let v=0;v<vertices.length;v++){
vertices[v].n=[];
for(let i=0;i<pairArr.length;i++){
if(
v==pairArr[i][0]
){
vertices[v].n.push(pairArr[i][1]);
}else if(
v==pairArr[i][1]
){
vertices[v].n.push(pairArr[i][0]);
}
if(i==pairArr.length-1){
vertices[v].nCount=vertices[v].n.length;
}
}//end i loop
}//end v loop
}//end get neighbors



function sortByNeighborCount(){
startTime=Date.now();
getNeighbors();
sortedVerts=[];
for(let v=0;v<vertices.length;v++){
sortedVerts[v]={nCount:vertices[v].nCount,i:vertices[v].i,n:vertices[v].n};
}
sortedVerts.sort((a,b)=>b.nCount-a.nCount);
}//end sortByNeighborCount



function colorGraph(){
for(let v=0;v<vertices.length;v++){
vertices[v].c=4;}

for(let v=0;v<sortedVerts.length;v++){
for(let c=0;c<4;c++){
let colorAvailable=true;
for(let n=0;n<sortedVerts[v].nCount;n++){
if(isThere(vertices[vertices[sortedVerts[v].i].n[n]])){
if(vertices[vertices[sortedVerts[v].i].n[n]].c==c){
colorAvailable=false;break;
}
}//isThere
}//end n loop
if(colorAvailable){vertices[sortedVerts[v].i].c=c;break;}
}//end c loop
}//end v loop
}//end colorGraph






function solveButton(){
if(solving&&el('solve').value=='Solve'){
el('solve').value='Solving...';
el('solve').style.backgroundColor='#ffd7d4';
}else if(!solving&&el('solve').value=='Solving...'){
el('solve').value='Solve';
el('solve').style.backgroundColor='#dbedff';
}
}//end solveButton



function buildRandomGraphButton(){
if(building&&el('buildRandomGraph').value=='Build Random Graph'){
el('buildRandomGraph').value='Building..........';
el('buildRandomGraph').style.backgroundColor='#ffd7d4';
}else if(!building&&el('buildRandomGraph').value=='Building..........'){
el('buildRandomGraph').value='Build Random Graph';
el('buildRandomGraph').style.backgroundColor='#dbedff';
}
}//end buildRandomGraphButton




function showSolvingButton(){
if((el('showSolving').value=='Solving...||'||el('showSolving').value=='Paused...\ > ')&&showSolving&&!stepping){
pauser=!pauser;}
stepping=false;
solving=false;
showSolving=true;
showSolvingStatus();
if(pauser){
el('showSolving').value='Paused...\ > ';
el('showSolving').style.backgroundColor='#ffd7d4';
}else if(!pauser||playOpening){el('showSolving').value='Solving...||';}
}//end showSolvingButton



function stepper(){
showSolving=false;

if(!rColorGraphDone){
rColorGraph(animSV);
animSV++;
if(animSV>sortedVerts.length-1){animSV=sortedVerts.length-1;}
}else if(rColorGraphDone){
recursiveNeighborSolver();
}
render();
}//end stepper


function showSolvingStatus(){
if(showSolving){
el('showSolving').style.backgroundColor='#dbedff';
el('showSolving').value='Solving...||';
}else{
el('showSolving').style.backgroundColor='white';
el('showSolving').value='Show Solving';
}
}//end showSolvingStatus


var counter1=0,counter2=0,counter3=0,counter4=0;



//called once onload
function animInit(){
cancelAnimationFrame(animId);
animId=0;
stepping=false;
rColorGraphDone=false;
solved=false;
pauser=false;
animSV=0;
animate();
showSolving=true;
activeButton('showSolving');
showSolvingStatus();
}//end animInit




function animate(){
clearTimeout(animateTimer);
animateTimer=setTimeout(function(){
animId=requestAnimationFrame(animate);

if(playOpening&&solved){solved=false;
clearTimeout(playOpeningTimer);
playOpeningTimer=setTimeout("buildAndRender();activeButton('showSolving');showSolvingButton();",3000);
}
if(showSolving&&!pauser&&!stepping){

if(!rColorGraphDone){
rColorGraph(animSV);
animSV++;
if(animSV>=sortedVerts.length-1){
//pauser=true;
rColorGraphDone=true;
}

}//if(!rColorGraphDone)

if(rColorGraphDone){
recursiveNeighborSolver();
}
render();
}//end!&&pauser
},1000/framesPerSecond);//end setTimeout
}//end animate





function rColorGraph(){
if(!isThere(sortedVerts[animSV])){
animSV=sortedVerts.length;
}else{

if(solved||stepping){
if(animSV==0){
rColorGraphDone=false;
for(let v=0;v<vertices.length;v++){
vertices[v].c=4;
}
}//if animSV==0
solved=false;
}//if solved

for(let c=0;c<4;c++){
let colorAvailable=true;
for(let n=0;n<sortedVerts[animSV].nCount;n++){
if(isThere(vertices[vertices[sortedVerts[animSV].i].n[n]])){
if(vertices[vertices[sortedVerts[animSV].i].n[n]].c==c){
colorAvailable=false;
break;
}
}//isThere
}//end n loop
if(colorAvailable){
vertices[sortedVerts[animSV].i].c=c;

if(animSV>=sortedVerts.length-1){
//pauser=true;
rColorGraphDone=true;
animSV=0;
}
break;
}//if colorAvailable
}//end c loop
}//isThere(sortedVerts[sv]
}//end rColorGraph







var checkCounter=0;
var foundUnsolved=false;

function recursiveNeighborSolver(){
numSolves++; 
numSolvesCounter=numSolves;

stillSearching=false;
let stringer='';
let errorString='';
checkCounter=0;

nonNeighbor=[];
for(let s=0;s<lastSearcher.length;s++){
nonNeighbor[s]=lastSearcher[s];
}
searcher=[];
lastSearcher=[];

nextVertex:
for(let v=0;v<vertices.length;v++){
let neighArray=[];
let neighColorCount=[];
let colorAvailable=[true,true,true,true];

if(vertices[v].c==4||vertices[v].searching){
stillSearching=true;


for(let n=0;n<vertices[v].nCount;n++){
if(isThere(vertices[vertices[v].n[n]])){
let nColor=vertices[vertices[v].n[n]].c;
neighArray.push({
i:vertices[v].n[n],
color:nColor
});

colorAvailable[nColor]=false;
}//isThere
}//end n loop

for(let c=0;c<4;c++){
if(colorAvailable[c]&&c!=vertices[v].c){
vertices[v].c=c;
vertices[v].searching=false;
continue nextVertex;
}
}//end c loop

let colorCounter=[];
for(let c=0;c<4;c++){
colorCounter[c]= neighArray.filter((obj)=>obj.color==c).length;

let nIndex=neighArray.filter(x=>x.color===c).map(x=>x.i);


let isNeigh=true;
for(let nn=0;nn<nonNeighbor.length;nn++){
for(let j=0;j<nIndex.length;j++){
if(nonNeighbor[nn]==nIndex[j]){isNeigh=false;}

}//end j loop
}//end nn loop

if(isNeigh){
neighColorCount.push({
nIndex:nIndex,
color:c, 
count:colorCounter[c]
});
}//isNeigh
}//end c loop

neighColorCount.sort((a,b)=>
a.count-b.count
||
a.color-b.color);

let ind=0;
if(loopingDetected){ind=randRange(1,2);
loopCounter++;
if(loopCounter>2){
loopingDetected=false;
}
}

if(isThere(neighColorCount[ind])&&isThere(neighColorCount[ind].nIndex[0])){

vertices[v].c=vertices[neighColorCount[ind].nIndex[0]].c;


for(let j=0;j<neighColorCount[ind].nIndex.length;j++){
searcher.push(neighColorCount[ind].nIndex[j]);

}//end j loop

lastSearcher.push(vertices[v].i);


//for looping detection
for(let i=0;i<neighColorCount[0].nIndex.length;i++){
nIndexString+=neighColorCount[0].nIndex[i]+' ';
}//i loop

chunkSolveString+=vertices[v].i+' '+nIndexString;
allSolvesString+=vertices[v].i+' '+nIndexString;

solveCounter++;
if(solveCounter==2){
solveCounter=0;


let regEx=new RegExp(chunkSolveString,'g');
let matchCount=(allSolvesString.match(regEx)||[]).length;

if(matchCount>1){
loopingDetected=true;
}

chunkSolveString='';
nIndexString='';
}//end if solveCounter greater than
//end looping detection

}//isThere neighColorCount
}//end if .c==4

//solve remaining same colored pairs
if(v==vertices.length-1&&(!stillSearching||tripleCheck)){

lastSearcher=[];
foundUnsolved=false;

for(let i=0;i<pairArr.length;i++){
if(isThere(vertices[pairArr[i][0]])&&isThere(vertices[pairArr[i][1]])){
if(
(vertices[pairArr[i][0]].c==
vertices[pairArr[i][1]].c)
||
(vertices[pairArr[i][0]].c==4)
||
(vertices[pairArr[i][1]].c==4)
){

vertices[pairArr[i][0]].searching=true;
vertices[pairArr[i][1]].searching=true;
lastSearcher.push(vertices[pairArr[i][0]].i);
lastSearcher.push(vertices[pairArr[i][1]].i);
vertices[pairArr[i][0]].c=0;
vertices[pairArr[i][1]].c=0;



solveRemainingPass++;
foundUnsolved=true;

}//if same color
}//isThere
}//end i loop

if(foundUnsolved){v=0;
}else if(!tripleCheck){
v=0;
checkCounter++;
if(checkCounter>3){
tripleCheck=true;}
}//if !tripleCheck
}//if v==vertices.length-1
//end solve remaining same colored pairs

}//end v loop

for(let v=0;v<vertices.length;v++){
vertices[v].searching=false;
for(let s=0;s<searcher.length;s++){
if(searcher[s]==vertices[v].i){
vertices[v].searching=true;
}
}//end s loop

if(v==vertices.length-1){

el('tester').scrollTop=el('tester').scrollHeight;

if(stillSearching==false){ //solved
endTime=Date.now();
deltaTime=endTime-startTime;
if(showSolving||stepping){showMessage('All Solved',2000);}
if(solving){
showMessage('Solved in: '+deltaTime+' ms',2000);
solving=false;solveButton();
}
rColorGraphDone=false;
solved=true;
animSV=0;
showSolving=false;
showSolvingStatus();
pairString='';
numSolves=0;
solveCounter=0;
chunkSolveString='';
loopingDetected=false;
nIndexString='';
solveRemainingPass=0;
tripleCheck=false;


render();
counter1=0;counter2=0;counter3=0;counter4=0;
return;
}else if(stillSearching==true){
if(numSolves==40){
animSV=0;
rColorGraph(animSV);
}else if(numSolves==100){
//alert('still solving after numSolves:'+numSolves);
tripleCheck=false;
checkCounter=0;
}else if(numSolves>1000){
alert('still solving after numSolves:'+numSolves+' so...returning.');
return;
}

if(!showSolving&&!pauser&&!stepping){
recursiveNeighborSolver();
}
}//if stillSearching
}//if(v==vertices.length-1){
}//end v loop
}//end recursiveNeighborSolver


function showMessage(messageString,time){
el('messageHolder').style.display='block';
da('message',messageString);
messageTimer=setTimeout("el('messageHolder').style.display='none';",time);
}//end show message

function hideMessage(timerId){
clearTimeout(timerId);
el('messageHolder').style.display='none';
}//hide message


function reSolverReset(){
pairString='';
da('tester','');
numSolves=0;
solveCounter=0;
chunkSolveString='';
allSolvesString='';
loopingDetected=false;
nIndexString='';
solveRemainingPass=0;
tripleCheck=false;
checkCounter=0;
rColorGraphDone=false;
solved=false;
}//end resolver reset


function getFlexibles(){
flexibles=[];

for(let v=0;v<vertices.length;v++){
flexibles[v]={
avail:false,
i: vertices[v].i,
colorsAvailable:[]
};
if(vertices[vertices[v].i].c!=4){
let colorAvailable=[true,true,true,true];
for(let c=0;c<4;c++){
for(let n=0;n<vertices[v].nCount;n++){
if(isThere(vertices[vertices[v].n[n]])){
if(
(vertices[v].c==c)||
(vertices[vertices[v].n[n]].c==c)){
colorAvailable[c]=false;
break;//next color
}
}//isThere
}//end n loop

if(colorAvailable[c]){
flexibles[v].avail=true;
flexibles[v].colorsAvailable.push(fourColorShort[c]);
}

}//end c loop
}//!=4
}//end v loop
}//end getFlexibles


function clamp(a,min,max){
if(a<min){a=min;}else if(a>max){a=max;}
return a;
}//end clamp

//ww=1366 hh=689 (on desktop at 100% browser zoom) 
//with onlySome
var numPoints=60;
var diam=100;
var vertSize=19;
var maxVertSize=25;
var minVertSize=16;

function graphRenderScaleFactors(){
diam=Math.sqrt(cW*cH/numPoints*.29);
vertSize=clamp(.27*diam,minVertSize,maxVertSize);
}//graphRenderScaleFactors

graphRenderScaleFactors();

function buildAndRender(){
clearTimeout(buildTimer);
vertices=[];
triangles=[];
pairArr=[];
pairString='';
//da('tester','');
numSolves=0;
solveCounter=0;
chunkSolveString='';
allSolvesString='';
loopingDetected=false;
nIndexString='';
solveRemainingPass=0;
tripleCheck=false;
rColorGraphDone=false;
solved=false;
solving=false;
showSolving=false;
linkStart=-1;
linkEnd=-1;
delaunay=true;

let radius=diam*.5;
let offset=.5*radius;
let onlySome=0;
let pointCounter=0;

if(setRandomVerts){
for(let y=radius*1.7;y<cH-radius;y+=diam){
if(pointCounter>=numPoints){break;}
for(let x=radius*1.5;x<cW-radius*1.5;x+=diam){
let randOffX=randRange(-offset,offset);
let randOffY=randRange(-offset,offset);
onlySome=randRange(1,30);
if(onlySome>20){
vertices.push(new Vertex(x+randOffX,y+randOffY,4,pointCounter,0,[],false));
pointCounter++;
triangles=triangulate(vertices);

if(pointCounter>=numPoints){break;}
}//onlySome
}//end x loop
}//end y loop


sortByNeighborCount();
if(!showSolving){
render();
}

}else if(!setRandomVerts){
getGraphData();
}

building=false;
activeButton('buildRandomGraph');
buildRandomGraphButton();

//da('tester',ww+'----'+hh+'----'+vertSize+'---'+Math.sqrt(cW*cH/numPoints*.29));
}// end buildAndRender



var renderCount=0;

function render(){
for(let v=0;v<vertices.length;v++){
vertices[v].i=v;}


if(showFlexibles){getFlexibles();}

//drawBackground
ctx.beginPath();
ctx.globalAlpha=1;
ctx.fillStyle='white';
ctx.fillRect(0, 0, cW, cH);
ctx.globalAlpha=1;
ctx.fillStyle=backgroundColor;//d6d651
ctx.fillRect(0, 0, cW, cH);
ctx.closePath();

//drawFrame that saves to image
ctx.globalAlpha=.4;
ctx.lineWidth=4;
ctx.strokeStyle='black';
ctx.strokeRect(0, 0, cW, cH);
ctx.lineWidth=2;
//end drawFrame


if(delaunay){
//draw triangles
ctx.globalAlpha=1;
let i=0;
triangles.forEach(function(triangle){
ctx.beginPath();
ctx.moveTo(triangle.v0.x, triangle.v0.y);
ctx.lineTo(triangle.v1.x, triangle.v1.y);
ctx.lineTo(triangle.v2.x, triangle.v2.y);
ctx.closePath();
ctx.strokeStyle="black";
ctx.lineWidth=1;
ctx.stroke();
//ctx.fillStyle='transparent';//triColors[i];
//ctx.fill();
i++;
});//end triangles foreach

}//!custom

if(!delaunay){
ctx.globalAlpha=1;



for(let i=0;i<pairArr.length;i++){
if(isThere(vertices[pairArr[i][0]])&&isThere(vertices[pairArr[i][1]])){

ctx.beginPath();

ctx.moveTo(
vertices[pairArr[i][0]].x, 
vertices[pairArr[i][0]].y);


ctx.lineTo(
vertices[pairArr[i][1]].x, vertices[pairArr[i][1]].y);

ctx.closePath();
ctx.strokeStyle='black';
ctx.lineWidth=1;
ctx.stroke();
}//isThere
}//end i loop
}//if !delaunay



//highlight same color vertices link


if(highlightSame){

sameColorVerts=[];
for(let i=0;i<pairArr.length;i++){
sameColorVerts[i]=false;
}

for(let i=0;i<pairArr.length;i++){
if(isThere(vertices[pairArr[i][0]])&&isThere(vertices[pairArr[i][1]])){
if(vertices[pairArr[i][0]].c==vertices[pairArr[i][1]].c){
sameColorVerts[i]=true;
}//end if
}//isThere
}//end i loop


for(let i=0;i<pairArr.length;i++){

if(sameColorVerts[i]){

ctx.beginPath();
ctx.moveTo(vertices[pairArr[i][0]].x, vertices[pairArr[i][0]].y);
ctx.lineTo(vertices[pairArr[i][1]].x, vertices[pairArr[i][1]].y);
ctx.closePath();
ctx.strokeStyle="black";
ctx.lineWidth=5;
ctx.stroke();

}//end if same color

}//end i loop

}//end if highlightSame

    

//draw vertices as circles
let ci=0;
this.vertices.forEach(function(vertex){
ctx.beginPath();
ctx.arc(vertex.x, vertex.y, vertSize, 0, Math.PI * 2, true);
ctx.closePath();

if(xray){
ctx.fillStyle='transparent';
}else{
ctx.fillStyle=fourColor[vertices[ci].c];
}
ctx.fill();


if(showFlexibles&&flexibles[ci].avail){
ctx.fillStyle='black';
for(let c=0;c<flexibles[ci].colorsAvailable.length;c++){
let coff=c*15;
ctx.fillText(flexibles[ci
].colorsAvailable[c],vertex.x+12+coff,vertex.y+39);
}//end c loop
ctx.strokeStyle='black';
ctx.lineWidth=9;
}else{
ctx.strokeStyle='black';
ctx.lineWidth=1;
}
ctx.stroke();



if(vertices[ci].c==4){
ctx.fillStyle='black';
}else{
ctx.fillStyle='white';
}
ctx.font="22px Monospace";
let xOff=5;
let yOff=8;
if(vertex.i>99){xOff=14;yOff=6;ctx.font="15px Monospace";}else
if(vertex.i>9){xOff=11;yOff=8;ctx.font="20px Monospace";}



if(showNumNeigh){
xOff=5;yOff=8;
ctx.fillText(vertex.nCount,vertex.x-xOff,vertex.y+yOff);
}else{
ctx.fillText(vertex.i,vertex.x-xOff,vertex.y+yOff);
}



ci++;
});//end vertices foreach

renderCount++;
}//end render




//Vertex object constructor; //returns {x:x,y:y,c:c,i:i,n:n,nCount:nCount,searching:searching}

function Vertex(x,y,c,i,n,nCount,searching){ 
this.x=x;
this.y=y;
this.c=c;//color
this.i=i;//index
this.n=n;//neighbors
this.nCount=nCount;//neighbors count
this.searching=searching;
}//end Vertex

      
//Triangle object constructor
//returns {v0:Vertex, v1:Vertex, v2:Vertex, center:Vertex, radius:number, radius_squared:number}

function Triangle(v0, v1, v2){ 
this.v0=v0;
this.v1=v1;
this.v2=v2;
//calculate circumcircle;we always do this when we build a new triangle object, so why not put it here in the constructor, instead of putting it somewhere else and calling it from here?
let A=this.v1.x - this.v0.x;
let B=this.v1.y - this.v0.y;
let C=this.v2.x - this.v0.x;
let D=this.v2.y - this.v0.y;
let E=A * (this.v0.x + this.v1.x) + B * (this.v0.y + this.v1.y);
let F=C * (this.v0.x + this.v2.x) + D * (this.v0.y + this.v2.y);
let G=2.0 * (A * (this.v2.y - this.v1.y) - B * (this.v2.x - this.v1.x));
let dx, dy;
if(Math.abs(G)<EPSILON){
let minx=Math.min(this.v0.x, this.v1.x, this.v2.x);
let miny=Math.min(this.v0.y, this.v1.y, this.v2.y);
let maxx=Math.max(this.v0.x, this.v1.x, this.v2.x);
let maxy=Math.max(this.v0.y, this.v1.y, this.v2.y);
this.center=new Vertex((minx + maxx) / 2, (miny + maxy) / 2, 4);
dx=this.center.x - minx;
dy=this.center.y - miny;
}else{
let cx=(D * E - B * F) / G;
let cy=(A * F - C * E) / G;
this.center=new Vertex(cx, cy, 4);
dx=this.center.x - this.v0.x;
dy=this.center.y - this.v0.y;
}
this.radius_squared=dx * dx + dy * dy;
this.radius=Math.sqrt(this.radius_squared);
//end calculate circumcircle;
}//end Triangle

//Edge object constructor; 
//returns {v0:Vertex,v1:vertex,equals:function,inverse:function}
function Edge(v0, v1){ 
this.v0=v0;
this.v1=v1;
this.equals=function(other){return (this.v0 === other.v0 && this.v1 === other.v1);};
this.inverse=function(){return new Edge(this.v1, this.v0);};
}//end edge


function triangulate(vertices){
pairString='';
let triangles=[];
let minx, miny, maxx, maxy;
vertices.forEach(function(vertex){
if(minx === undefined || vertex.x<minx){ minx=vertex.x;}
if(miny === undefined || vertex.y<miny){ miny=vertex.y;}
if(maxx === undefined || vertex.x > maxx){ maxx=vertex.x;}
if(maxy === undefined || vertex.y > maxy){ maxy=vertex.y;}
});
let dx=(maxx - minx) * 10;
let dy=(maxy - miny) * 10;
let stv0=new Vertex(minx - dx, miny - dy * 3, 4);
let stv1=new Vertex(minx - dx, maxy + dy, 4);
let stv2=new Vertex(maxx + dx * 3, maxy + dy, 4);
let st=new Triangle(stv0, stv1, stv2);
triangles.push(st);

let ci=0;
vertices.forEach(function(vertex){
vertex.i=ci;
ci++;

edges=[];
triangles=triangles.filter(function(triangle){
let dx=triangle.center.x - vertex.x;
let dy=triangle.center.y - vertex.y;
let dist_squared=dx * dx + dy * dy;
let inCirc=(dist_squared <= triangle.radius_squared);
if(inCirc){
edges.push(new Edge(triangle.v0, triangle.v1));
edges.push(new Edge(triangle.v1, triangle.v2));
edges.push(new Edge(triangle.v2, triangle.v0));
return false;
}else{
return true;
}
});

let uniqueEdgesArray=[];


for(let i=0;i<edges.length;++i){
let edge1=edges[i];

let unique=true;
for(let j=0;j<edges.length;++j){
if(i === j){continue;}
let edge2=edges[j];
if(edge1.equals(edge2) || edge1.inverse().equals(edge2)){unique=false;break;}
} //end j loop
if(unique){
uniqueEdgesArray.push(edge1);
}
}//end i loop
edges=uniqueEdgesArray;

edges.forEach(function(edge){
triangles.push(new Triangle(edge.v0, edge.v1, vertex));
});//end foreach edges
});//end foreach vertices


triangles=triangles.filter(function(triangle){
return !(triangle.v0 == st.v0 || triangle.v0 == st.v1 || triangle.v0 == st.v2 ||
triangle.v1 == st.v0 || triangle.v1 == st.v1 || triangle.v1 == st.v2 ||
triangle.v2 == st.v0 || triangle.v2 == st.v1 || triangle.v2 == st.v2);
});


return triangles;
}//end triangulate



document.body.onload=function(){init();}

document.body.onkeydown=function(){onKeyDowner(event);}


onKeyDowner=function(event){
if(!typing){
if(event.key=='z'){altKey=true;}
switch(event.key){
case 'k':
showHide('shortcutKeys');
break;
case 'p':
activeButton('showSolving');playOpening=false;showSolvingButton();
break;
case 's':
activeButton('solve');stepping=false;pauser=false;showSolving=false;solving=true;solveButton();clearTimeout(solveTimer);solveTimer=setTimeout('for(let v=0;v<vertices.length;v++){vertices[v].c=4;}sortByNeighborCount();colorGraph();recursiveNeighborSolver();',10);
break;
case 'v': 
activeButton('step');solved=false;stepping=true;stepper();showSolving=false;showSolvingStatus();
break;
case 'b':
activeButton('buildRandomGraph');building=true;buildRandomGraphButton();setRandomVerts=true;clearTimeout(buildTimer);buildTimer=setTimeout('buildAndRender();',50);canv.onmousedown=function(e){setRandomVerts=true;buildAndRender();};
break;
case 'h':controlPanelOpenClose();
break;
case 'a':
activeButton('addVertex');canv.onmousedown=function(e){delaunay=true;mouseAdd_Vertex(e);solved=false;}
break;
case 'm':
activeButton('moveVertex');canv.onmousedown=function(e){el('expander').style.visibility='hidden';dragging=true;moveRaw=false;getVertexToEdit(e);solved=false;}
break;
case 'd':
activeButton('deleteVertex');canv.onmousedown=function(e){getVertexToEdit(e);deleteVertex(e,true);solved=false;}
break;
case 'c':
activeButton('colorVerts');canv.onmousedown=function(e){getVertexToEdit(e);changeVertexColor(e);solved=false;}
break;
case 't':
activeButton('testerButton');showHide('testerHolder');el('tester').scrollTop=el('tester').scrollHeight;
break;
case 'n':
activeButton('numberOfVerts');el('enterNumVerts').value=numPoints;showHideV('numVertsInputDiv');
break;
case 'f':
activeButton('fpsId');el('enterFPS').value=parseInt(framesPerSecond);showHideV('fpsInputDiv');
break;
case 'y':
activeButton('timeToSolveId');showMessage('Solved in: '+deltaTime+' ms<br> after '+ numSolvesCounter+' steps',2000);
break;
case 'g':
activeButton('neighs');if(showNumNeigh){showNumNeigh=false;}else{showNumNeigh=true;}render();
break;
case 'x':
activeButton('flexiblesButton');showFlexibles=!showFlexibles;render();
break;j
case 'o':
activeButton('consoleButton');showHideV('consoleInputDiv');render();
break;
case '1':
activeButton('addButton');gettingLinkStart=false;delaunay=false;canv.onmousedown=function(e){el('expander').style.visibility='hidden';mouseAdd_Vertex(e);solved=false;}
break;
case '2':
activeButton('addLinkedButton');delaunay=false;gettingLinkStart=true;canv.onmousedown=function(e){el('expander').style.visibility='hidden';getVertexToEdit(e);solved=false;}
break;
case '3':
activeButton('moveVertButton');canv.onmousedown=function(e){el('expander').style.visibility='hidden';dragging=true;moveRaw=true;getVertexToEdit(e);solved=false;}
break;
case '4':
activeButton('deleteVertButton');canv.onmousedown=function(e){delaunay=false;getVertexToEdit(e);deleteVertex(e,false);solved=false;}
break;
}//end switch
}//end if(!typing){
}//end onKeyDowner


function isFullScreen(){
return (document.fullScreenElement && document.fullScreenElement !== null)
|| document.mozFullScreen
|| document.webkitIsFullScreen;
}//end is full screen

function requestFullScreen(){
var el=document.documentElement;
var rfs=el.requestFullscreen
|| el.webkitRequestFullScreen
|| el.mozRequestFullScreen
|| el.msRequestFullscreen;
rfs.call(el);
}//end request full screen 

function exitFullScreen(){
var d=document;
var rfs=d.exitFullscreen
|| d.webkitExitFullscreen
|| d.mozCancelFullScreen
|| d.msExitFullscreen ;
rfs.call(d);
}//end exit fullscreen

function toggleFullScreen(){
if(isFullScreen()){exitFullScreen();
}else{requestFullScreen();
}
}//end toggle full screen
</script>

</body>
</html>